<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>

<div class="container my-5">

    <!--<div class="row">

        <div class="col-md-7 mb-4 mb-md-0">-->
    <!-- Table -->
    <!--<table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Test</th>
                    </tr>
                </thead>
                <tbody id="demo"></tbody>
            </table>

        </div>
    </div>-->

    <form id="topID">
        <div hidden>
            Hidden Read
            <input type="text" name="read" id="read" readonly>
        </div>

        <div align="center">
            <h1>
                Lords of Kingdoma
            </h1>
        </div>
    </form>

    <br />
    <form id="loginID">
        <div align="center">
            Name
            <input type="text" name="playerName" id="id">
            <input type="button" value="Enter Name" onclick="confirmName()">
        </div>
    </form>
    <style>
        .loginPasswordClass {
            display: none;
        }
    </style>
    <form class="loginPasswordClass" id="loginIDPassword">
        <div align="center">
            Password
            <input type="text" name="password" id="password">
            <input type="button" value="Log In" onclick="logIn()">
        </div>
    </form>

    <script>
        var loggedIn = false;

        function confirmName() {
            insert_value(true, false);
            checkIfHideBottom();
        }
        function logIn() {
            insert_value(false, true);
            checkIfHideBottom();
        }
        function deleteAccount() {
            delete_value();
            clearLogin();
        }
        function clearLogin() {
            loggedIn = false;

            document.getElementById("id").value = "";
            document.getElementById("password").value = "";
            checkIfHideBottom();
        }
    </script>

    <script>
        // Save in database
        var dName;
        var dPassword;
        var dCurrentArea = "Woodshire";
        var dMilitary = 10;
        var dLords = 2;
        var dFood = 50;
        var dIron = 0;
        var dCoal = 0;
        var dLeather = 0;
        var dCloth = 0;
        var dObsidian = 0;
        var dGold = 50;
        var dWood = 0;
        var dIronMine = 0;
        var dCoalMine = 0;
        var dPasture = 0;
        var dCottonField = 0;
        var dObsidianMine = 0;
        var dFarm = 0;
        var dGoldMine = 0;
        var dLumbermill = 0;
        var dHealing = 0;
        var dDungeon = 0;
        var dTavern = 0;
        var dMarket = 0;
        var dBarracks = 0;
        var dStable = 0;

        var dTravelingTo = "";
        var dLastDate = 0;

        var dMessages = "";

        // Setters
        function setCurrentArea(val, noUpdate = false) {
            dCurrentArea = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setMilitary(val, noUpdate = false) {
            dMilitary = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setLords(val, noUpdate = false) {
            dLords = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setFood(val, noUpdate = false) {
            dFood = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setIron(val, noUpdate = false) {
            dIron = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setCoal(val, noUpdate = false) {
            dCoal = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setLeather(val, noUpdate = false) {
            dLeather = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setCloth(val, noUpdate = false) {
            dCloth = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setObsidian(val, noUpdate = false) {
            dObsidian = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setGold(val, noUpdate = false) {
            dGold = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setWood(val, noUpdate = false) {
            dWood = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setIronMine(val, noUpdate = false) {
            dIronMine = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setCoalMine(val, noUpdate = false) {
            dCoalMine = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setPasture(val, noUpdate = false) {
            dPasture = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setCottonField(val, noUpdate = false) {
            dCottonField = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setObsidianMine(val, noUpdate = false) {
            dObsidianMine = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setFarm(val, noUpdate = false) {
            dFarm = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setGoldMine(val, noUpdate = false) {
            dGoldMine = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setLumbermill(val, noUpdate = false) {
            dLumbermill = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setHealing(val, noUpdate = false) {
            dHealing = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setDungeon(val, noUpdate = false) {
            dDungeon = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setTavern(val, noUpdate = false) {
            dTavern = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setMarket(val, noUpdate = false) {
            dMarket = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setBarracks(val, noUpdate = false) {
            dBarracks = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setStable(val, noUpdate = false) {
            dStable = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setTravelingTo(val, noUpdate = false) {
            dTravelingTo = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setLastDate(val, noUpdate = false) {
            dLastDate = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }
        function setMessages(val, noUpdate = false) {
            dMessages = val;
            if (noUpdate) {
                return;
            }
            update_value();
        }

        // Access database
        var playersDatabase = [];

        function maxMilitary() {
            return 100 + (+dBarracks * 10);
        }
        function militaryStrength() {
            return 1 + (1 * +dStable);
        }
        function militaryCost() {
            return 1 + (+dBarracks * 2);
        }
        function lordCost() {
            if (GetTotalStructures() > 3) {
                return 1 + (GetTotalStructures() * 3);
            }
            else {
                return 5;
            }
        }

        // (!)
        function changeDatabaseData(id, category, value) {
            $("#re").css("visibility", "hidden");
            var id1 = id;

            var url = script_url + "?callback=ctrlq&id=" + id1 + "&password=" + "!"
                + "&currentarea=" + (category === "currentarea" ? value : "!")
                + "&military=" + (category === "military" ? value : "!")
                + "&lords=" + (category === "lords" ? value : "!")
                + "&food=" + (category === "food" ? value : "!")
                + "&iron=" + (category === "iron" ? value : "!")
                + "&coal=" + (category === "coal" ? value : "!")
                + "&leather=" + (category === "leather" ? value : "!")
                + "&cloth=" + (category === "cloth" ? value : "!")
                + "&obsidian=" + (category === "obsidian" ? value : "!")
                + "&gold=" + (category === "gold" ? value : "!")
                + "&wood=" + (category === "wood" ? value : "!")
                + "&ironmine=" + (category === "ironmine" ? value : "!")
                + "&coalmine=" + (category === "coalmine" ? value : "!")
                + "&pasture=" + (category === "pasture" ? value : "!")
                + "&cottonfield=" + (category === "cottonfield" ? value : "!")
                + "&obsidianmine=" + (category === "obsidianmine" ? value : "!")
                + "&farm=" + (category === "farm" ? value : "!")
                + "&goldmine=" + (category === "goldmine" ? value : "!")
                + "&lumbermill=" + (category === "lumbermill" ? value : "!")
                + "&healing=" + (category === "healing" ? value : "!")
                + "&dungeon=" + (category === "dungeon" ? value : "!")
                + "&tavern=" + (category === "tavern" ? value : "!")
                + "&market=" + (category === "market" ? value : "!")
                + "&barracks=" + (category === "barracks" ? value : "!")
                + "&stable=" + (category === "stable" ? value : "!")
                + "&travelingto=" + (category === "travelingto" ? value : "!")
                + "&lastdate=" + (category === "lastdate" ? value : "!")
                + "&messages=" + (category === "messages" ? value : "!")
                + "&addValue=" + "true"
                + "&action=update";

            var request = jQuery.ajax({
                crossDomain: true,
                url: url,
                method: "GET",
                dataType: "jsonp"
            })
                .always(function (result) {
                    updateTable();
                });
        }

        // (!)
        function setDataWithName() {
            var id = $("#id").val();
            readSpecifiedData(id, "name");
            readSpecifiedData(id, "password");
            readSpecifiedData(id, "currentarea");
            readSpecifiedData(id, "military");
            readSpecifiedData(id, "lords");
            readSpecifiedData(id, "food");
            readSpecifiedData(id, "iron");
            readSpecifiedData(id, "coal");
            readSpecifiedData(id, "leather");
            readSpecifiedData(id, "cloth");
            readSpecifiedData(id, "obsidian");
            readSpecifiedData(id, "gold");
            readSpecifiedData(id, "wood");
            readSpecifiedData(id, "ironmine");
            readSpecifiedData(id, "coalmine");
            readSpecifiedData(id, "pasture");
            readSpecifiedData(id, "cottonfield");
            readSpecifiedData(id, "obsidianmine");
            readSpecifiedData(id, "farm");
            readSpecifiedData(id, "goldmine");
            readSpecifiedData(id, "lumbermill");
            readSpecifiedData(id, "healing");
            readSpecifiedData(id, "dungeon");
            readSpecifiedData(id, "tavern");
            readSpecifiedData(id, "market");
            readSpecifiedData(id, "barracks");
            readSpecifiedData(id, "stable");
            readSpecifiedData(id, "travelingto");
            readSpecifiedData(id, "lastdate");
            readSpecifiedData(id, "messages");
        }

        //function readDataOffButton() {
        //    var id = $("#id").val();
        //    var password = $("#password").val();

        //    readSpecifiedData(id, "password");
        //}
        function readSpecifiedData(id, dataCategory, setValue = true) {
            var url = "https://spreadsheets.google.com/feeds/list/1Z04ovPRCW-_2xDf4x1kAGzCSvt__JO-e4eUywErOZHk/od6/public/values?alt=json";

            var request = jQuery.ajax({
                crossDomain: true,
                url: url,
                method: "GET",
                dataType: "jsonp",
            })
                .always(function (data, textStatus, jqXHR) {
                    //document.getElementById("demo").innerHTML = "";
                    let resultdata = data.feed.entry;
                    let i;
                    for (i = 0; i < resultdata.length; i++) {
                        let idData = resultdata[i]["gsx$id"]["$t"];
                        let specData = resultdata[i]["gsx$id"]["$t"];
                        try {
                            specData = resultdata[i]["gsx$".concat((dataCategory !== "name" ? dataCategory : "id"))]["$t"];
                        }
                        catch (e) {
                            console.log(dataCategory);
                        }

                        if (idData === id) {
                            var ret;
                            ret = specData;

                            if (setValue) {
                                document.getElementById("read").value = ret;
                                setSpecificDataToRead(dataCategory);
                            }
                            else {
                                return ret;
                            }
                        }
                    }
                });
        }
        function setSpecificDataToRead(dataCategory) {
            if (dataCategory === "name") {
                dName = document.getElementById("read").value;
            }
            else if (dataCategory === "password") {
                dPassword = document.getElementById("read").value;
            }
            else if (dataCategory === "currentarea") {
                dCurrentArea = document.getElementById("read").value;
            }
            else if (dataCategory === "military") {
                dMilitary = document.getElementById("read").value;
            }
            else if (dataCategory === "lords") {
                dLords = document.getElementById("read").value;
            }
            else if (dataCategory === "food") {
                dFood = document.getElementById("read").value;
            }
            else if (dataCategory === "iron") {
                dIron = document.getElementById("read").value;
            }
            else if (dataCategory === "coal") {
                dCoal = document.getElementById("read").value;
            }
            else if (dataCategory === "leather") {
                dLeather = document.getElementById("read").value;
            }
            else if (dataCategory === "cloth") {
                dCloth = document.getElementById("read").value;
            }
            else if (dataCategory === "obsidian") {
                dObsidian = document.getElementById("read").value;
            }
            else if (dataCategory === "gold") {
                dGold = document.getElementById("read").value;
            }
            else if (dataCategory === "wood") {
                dWood = document.getElementById("read").value;
            }
            else if (dataCategory === "ironmine") {
                dIronMine = document.getElementById("read").value;
            }
            else if (dataCategory === "coalmine") {
                dCoalMine = document.getElementById("read").value;
            }
            else if (dataCategory === "pasture") {
                dPasture = document.getElementById("read").value;
            }
            else if (dataCategory === "cottonfield") {
                dCottonField = document.getElementById("read").value;
            }
            else if (dataCategory === "obsidianmine") {
                dObsidianMine = document.getElementById("read").value;
            }
            else if (dataCategory === "farm") {
                dFarm = document.getElementById("read").value;
            }
            else if (dataCategory === "goldmine") {
                dGoldMine = document.getElementById("read").value;
            }
            else if (dataCategory === "lumbermill") {
                dLumbermill = document.getElementById("read").value;
            }
            else if (dataCategory === "healing") {
                dHealing = document.getElementById("read").value;
            }
            else if (dataCategory === "dungeon") {
                dDungeon = document.getElementById("read").value;
            }
            else if (dataCategory === "tavern") {
                dTavern = document.getElementById("read").value;
            }
            else if (dataCategory === "market") {
                dMarket = document.getElementById("read").value;
            }
            else if (dataCategory === "barracks") {
                dBarracks = document.getElementById("read").value;
            }
            else if (dataCategory === "stable") {
                dStable = document.getElementById("read").value;
            }
            else if (dataCategory === "travelingto") {
                dTravelingTo = document.getElementById("read").value;
            }
            else if (dataCategory === "lastdate") {
                dLastDate = document.getElementById("read").value;
            }
            else if (dataCategory === "messages") {
                if (document.getElementById("read").value !== "") {
                    dMessages = document.getElementById("read").value;
                }
                else {
                    dMessages = "";
                }
            }
            document.getElementById("read").value = "";

            updateTable();
        }

        function getListPlayers() {
            var url = "https://spreadsheets.google.com/feeds/list/1Z04ovPRCW-_2xDf4x1kAGzCSvt__JO-e4eUywErOZHk/od6/public/values?alt=json";

            var request = jQuery.ajax({
                crossDomain: true,
                url: url,
                method: "GET",
                dataType: "jsonp",
            })
                .always(function (data, textStatus, jqXHR) {

                    var listOfPlayers = [];

                    let resultdata = data.feed.entry;
                    let i;

                    for (i = 0; i < resultdata.length; i++) {
                        let idData = resultdata[i]["gsx$id"]["$t"];
                        let currentAreaData = resultdata[i]["gsx$currentarea"]["$t"];
                        let militaryData = resultdata[i]["gsx$military"]["$t"];
                        let goldData = resultdata[i]["gsx$gold"]["$t"];

                        listOfPlayers.push('&' + idData + '!' + currentAreaData + '!' + militaryData + '!' + goldData);
                    }

                    document.getElementById("read").value = listOfPlayers;
                    createPlayerDatabase();
                });
        }
        function createPlayerDatabase() {
            var temp = document.getElementById("read").value;

            var split = temp.split('&');
            split.splice(0, 1);

            playersDatabase = [];

            for (var i = 0; i < split.length; i++) {
                playersDatabase.push(split[i]);
            }

            // Set list of areas/players
            document.getElementById("areaListText").innerHTML = GetAreaPlayerList();
        }
        // (!)
        function getDataFromPlayersDatabase(id, category) {
            for (var i = 0; i < playersDatabase.length; i++) {
                var split = playersDatabase[i].split('!');
                if (split[0] === id) {
                    if (category === "currentarea") {
                        return split[1];
                    }
                    else if (category === "military") {
                        return split[2];
                    }
                    else if (category === "gold") {
                        return split[3];
                    }
                }
            }
            return null;
        }
        // (!)
        function getAllPlayerNames() {
            var ret = [];
            for (var i = 0; i < playersDatabase.length; i++) {
                var split = playersDatabase[i].split('!');
                ret.push(split[0]);
            }
            return ret;
        }
    </script>

    <script>
        function updateTable() {
            if (+dMilitary < 0) {
                setMilitary(0, true);
                setLords(1);
            }

            document.getElementById("currentarea").value = dCurrentArea;
            document.getElementById("military").value = dMilitary;
            document.getElementById("lords").value = dLords;
            document.getElementById("food").value = dFood;
            document.getElementById("iron").value = dIron;
            document.getElementById("coal").value = dCoal;
            document.getElementById("leather").value = dLeather;
            document.getElementById("cloth").value = dCloth;
            document.getElementById("obsidian").value = dObsidian;
            document.getElementById("gold").value = dGold;
            document.getElementById("wood").value = dWood;
            document.getElementById("ironmine").value = dIronMine;
            document.getElementById("coalmine").value = dCoalMine;
            document.getElementById("pasture").value = dPasture;
            document.getElementById("cottonfield").value = dCottonField;
            document.getElementById("obsidianmine").value = dObsidianMine;
            document.getElementById("farm").value = dFarm;
            document.getElementById("goldmine").value = dGoldMine;
            document.getElementById("lumbermill").value = dLumbermill;
            document.getElementById("healing").value = dHealing;
            document.getElementById("dungeon").value = dDungeon;
            document.getElementById("tavern").value = dTavern;
            document.getElementById("market").value = dMarket;
            document.getElementById("barracks").value = dBarracks;
            document.getElementById("stable").value = dStable;
            document.getElementById("travelingto").value = dTravelingTo;
            //document.getElementById("lastdate").value = dLastDate;

            // Chain of methods to update area/player list
            getListPlayers();

            document.getElementById("ironminedescription").innerHTML = GetStructureDescription('ironmine');
            document.getElementById("coalminedescription").innerHTML = GetStructureDescription('coalmine');
            document.getElementById("pasturedescription").innerHTML = GetStructureDescription('pasture');
            document.getElementById("cottonfielddescription").innerHTML = GetStructureDescription('cottonfield');
            document.getElementById("obsidianminedescription").innerHTML = GetStructureDescription('obsidianmine');
            document.getElementById("farmdescription").innerHTML = GetStructureDescription('farm');
            document.getElementById("goldminedescription").innerHTML = GetStructureDescription('goldmine');
            document.getElementById("lumbermilldescription").innerHTML = GetStructureDescription('lumbermill');
            document.getElementById("healingdescription").innerHTML = GetStructureDescription('healing');
            document.getElementById("dungeondescription").innerHTML = GetStructureDescription('dungeon');
            document.getElementById("taverndescription").innerHTML = GetStructureDescription('tavern');
            document.getElementById("marketdescription").innerHTML = GetStructureDescription('market');
            document.getElementById("barracksdescription").innerHTML = GetStructureDescription('barracks');
            document.getElementById("stabledescription").innerHTML = GetStructureDescription('stable');

            document.getElementById("militarycost").innerHTML = 'Purchase Military (' + militaryCost() + ' gold)';
            document.getElementById("lordcost").innerHTML = 'Purchase Lords (' + lordCost() + ' gold)';

            document.getElementById("messages").innerHTML = MessagesText();

            //var url = "https://spreadsheets.google.com/feeds/list/1Z04ovPRCW-_2xDf4x1kAGzCSvt__JO-e4eUywErOZHk/od6/public/values?alt=json";
            //var request = jQuery.ajax({
            //    crossDomain: true,
            //    url: url,
            //    method: "GET",
            //    dataType: "jsonp"
            //})
            //    .always(function (data, textStatus, jqXHR) {
            //        document.getElementById("demo").innerHTML = "";
            //        //console.log(data);
            //        let resultdata = data.feed.entry;
            //        //console.log(resultdata);
            //        let i;
            //        for (i = 0; i < resultdata.length; i++) {
            //            let idData = resultdata[i]["gsx$id"]["$t"];
            //            let nameData = resultdata[i]["gsx$name"]["$t"];
            //            let testData = resultdata[i]["gsx$test"]["$t"];

            //            document.getElementById("demo").innerHTML +=
            //                "<tr>" +
            //                "<td>" +
            //                idData +
            //                "</td>" +
            //                "<td>" +
            //                nameData +
            //                "</td>" +
            //                "<td>" +
            //                testData +
            //                "</td>" +
            //                "</tr>";
            //        }

            //    });
            ////readData("fff", "test");
        }
        updateTable();
    </script>

    <!--style>
        table, th, td {
            margin: 10px 0;
            border: solid 1px #333;
            padding: 2px 4px;
            font: 15px Verdana;
        }

        th {
            font-weight: bold;
        }
    </style>-->

    <script>
        function checkIfHideBottom() {
            if ($("#id").val() == "") {
                loggedIn = false;

                document.getElementById("loginID").style.display = "block";
                document.getElementById("loginIDPassword").style.display = "none";
                document.getElementById("bottomID").style.display = "none";
            }
            else if ($("#password").val() == "") {
                loggedIn = false;

                document.getElementById("loginID").style.display = "none";
                document.getElementById("loginIDPassword").style.display = "block";
                document.getElementById("bottomID").style.display = "none";
            }
            else {
                loggedIn = true;

                document.getElementById("loginID").style.display = "none";
                document.getElementById("loginIDPassword").style.display = "none";
                document.getElementById("bottomID").style.display = "block";
            }
        }

        var script_url = "https://script.google.com/macros/s/AKfycbwwdipED9EcpigF_D3k1gfEHcW_kkdEm0yzYp6o8tOjNMPk7FyE6qoTwXsFpsESGY5C/exec";

        function insert_value(nameFirst = false, passwordSecond = false) {
            $("#re").css("visibility", "hidden");
            var id1 = $("#id").val();
            var password = $("#password").val();

            // Update data with name first
            if (nameFirst) {
                setDataWithName();
            }
            else if (passwordSecond) {
                // If database password not empty, compare to database password
                if (dPassword !== "" && password !== dPassword) {
                    alert("Please log in again");
                    clearLogin();
                    return;
                }
                // If database password is empty, create new password if password is not empty
                else if (dPassword === "") {
                    if (password !== "") {
                        //console.log(password);
                        update_value();
                    }
                    else {
                        alert("Please enter a name and password");
                        clearLogin();
                        return;
                    }
                }
                else if (id1 === "") {
                    alert("Please enter a name and password");
                    clearLogin();
                    return;
                }
            }
            else {
                checkIfHideBottom();
            }

            loggedIn = true;

            var url = script_url + "?callback=ctrlq&id=" + id1 + "&password=" + password
                + "&currentarea=" + (nameFirst ? "Woodshire" : dCurrentArea)
                + "&military=" + (nameFirst ? 10 : dMilitary)
                + "&lords=" + (nameFirst ? 2 : dLords)
                + "&food=" + (nameFirst ? 50 : dFood)
                + "&iron=" + (nameFirst ? 0 : dIron)
                + "&coal=" + (nameFirst ? 0 : dCoal)
                + "&leather=" + (nameFirst ? 0 : dLeather)
                + "&cloth=" + (nameFirst ? 0 : dCloth)
                + "&obsidian=" + (nameFirst ? 0 : dObsidian)
                + "&gold=" + (nameFirst ? 0 : dGold)
                + "&wood=" + (nameFirst ? 0 : dWood)
                + "&ironmine=" + (nameFirst ? 0 : dIronMine)
                + "&coalmine=" + (nameFirst ? 0 : dCoalMine)
                + "&pasture=" + (nameFirst ? 0 : dPasture)
                + "&cottonfield=" + (nameFirst ? 0 : dCottonField)
                + "&obsidianmine=" + (nameFirst ? 0 : dObsidianMine)
                + "&farm=" + (nameFirst ? 0 : dFarm)
                + "&goldmine=" + (nameFirst ? 0 : dGoldMine)
                + "&lumbermill=" + (nameFirst ? 0 : dLumbermill)
                + "&healing=" + (nameFirst ? 0 : dHealing)
                + "&dungeon=" + (nameFirst ? 0 : dDungeon)
                + "&tavern=" + (nameFirst ? 0 : dTavern)
                + "&market=" + (nameFirst ? 0 : dMarket)
                + "&barracks=" + (nameFirst ? 0 : dBarracks)
                + "&stable=" + (nameFirst ? 0 : dStable)
                + "&travelingto=" + (nameFirst ? "" : dTravelingTo)
                + "&lastdate=" + (nameFirst ? 0 : dLastDate)
                + "&messages=" + (nameFirst ? 0 : dMessages)
                + "&action=insert";

            var request = jQuery.ajax({
                crossDomain: true,
                url: url,
                method: "GET",
                dataType: "jsonp"
            })
                .always(function () {
                    updateTable();
                });
        }

        function update_value() {
            $("#re").css("visibility", "hidden");
            var id1 = $("#id").val();
            var password = $("#password").val();
            //dLastDate = new Date().getTime();
            
            var url = script_url + "?callback=ctrlq&id=" + id1 + "&password=" + password
                + "&currentarea=" + dCurrentArea
                + "&military=" + dMilitary
                + "&lords=" + dLords
                + "&food=" + dFood
                + "&iron=" + dIron
                + "&coal=" + dCoal
                + "&leather=" + dLeather
                + "&cloth=" + dCloth
                + "&obsidian=" + dObsidian
                + "&gold=" + dGold
                + "&wood=" + dWood
                + "&ironmine=" + dIronMine
                + "&coalmine=" + dCoalMine
                + "&pasture=" + dPasture
                + "&cottonfield=" + dCottonField
                + "&obsidianmine=" + dObsidianMine
                + "&farm=" + dFarm
                + "&goldmine=" + dGoldMine
                + "&lumbermill=" + dLumbermill
                + "&healing=" + dHealing
                + "&dungeon=" + dDungeon
                + "&tavern=" + dTavern
                + "&market=" + dMarket
                + "&barracks=" + dBarracks
                + "&stable=" + dStable
                + "&travelingto=" + dTravelingTo
                + "&lastdate=" + dLastDate
                + "&messages=" + dMessages
                + "&addValue=" + "false"
                + "&action=update";

            var request = jQuery.ajax({
                crossDomain: true,
                url: url,
                method: "GET",
                dataType: "jsonp"
            })
                .always(function (result) {
                    updateTable();
                });
        }

        function delete_value() {
            $("#re").css("visibility", "hidden");
            $('#mySpinner').addClass('spinner');
            var id1 = $("#id").val();
            var password = $("#password").val();

            var url = script_url + "?callback=ctrlq&id=" + id1 + "&password=" + password + "&action=delete";
            var request = jQuery.ajax({
                crossDomain: true,
                url: url,
                method: "GET",
                dataType: "jsonp"
            })
                .always(function () {
                    updateTable();
                });

        }

        // print the returned data
        function ctrlq(e) {
            $("#re").html(e.result);
            $("#re").css("visibility", "visible");
            //read_value();
        }

        //function read_value() {

        //    $("#re").css("visibility", "hidden");

        //    //document.getElementById("loader").style.visibility = "visible";
        //    var url = script_url + "?action=read";

        //    $.getJSON(url, function (json) {

        //        // Set the variables from the results array
        //        // CREATE DYNAMIC TABLE.
        //        var table = document.createElement("table");

        //        var header = table.createTHead();
        //        var row = header.insertRow(0);
        //        var cell1 = row.insertCell(0);
        //        var cell2 = row.insertCell(1);

        //        cell1.innerHTML = "<b>ID</b>";
        //        cell2.innerHTML = "<b>Name</b>";

        //        // ADD JSON DATA TO THE TABLE AS ROWS.
        //        for (var i = 0; i < json.records.length; i++) {

        //            tr = table.insertRow(-1);
        //            var tabCell = tr.insertCell(-1);
        //            tabCell.innerHTML = json.records[i].ID;
        //            tabCell = tr.insertCell(-1);
        //            tabCell.innerHTML = json.records[i].NAME;
        //        }

        //        // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
        //        var divContainer = document.getElementById("showData");
        //        divContainer.innerHTML = "";
        //        divContainer.appendChild(table);
        //        //document.getElementById("loader").style.visibility = "hidden";
        //        $("#re").css("visibility", "visible");
        //    });
        //}

    </script>

    <style>
        .bottom {
            display: none;
        }

        .databasetable {
            float: left;
            /*display: none;*/
        }

        .arealist {
            float: right;
            /*display: none;*/
        }

        .manufacturing {
            display: none;
        }

        .civil {
            display: none;
        }

        .commerce {
            display: none;
        }

        .military {
            display: none;
        }
    </style>
    <div class="bottom" id="bottomID" align="center">
        <div align="right">
            <input type="button" value="Delete Account" onclick="deleteAccount()">
        </div>
        <br />
        <div align="right">
            <input type="button" onClick="clearLogin()" value="Logout" />
        </div>
        <br />
        <div align="right">
            <input type="button" onClick="update_value())" value="Save" />
        </div>
        <br />

        <div hidden>
            <!--This could be used to get messages back from Google-->
            <p id="re"></p>
        </div>

        <!--<input type="button" onClick="insert_value()" value="Insert" />-->
        <!--<input type="button" onclick="read_value()" value="Read" />-->
        <!--<input type="button" onclick="update_value()" value="Update" />
        <input type="button" onclick="delete_value()" value="Delete" />-->
        <!--<input type="button" onclick="readDataOffButton()" value="Read" />-->
        <!--<div id="showData"></div>-->

        <div>
            <!--<button class="topbar" onclick="ConstructionTab()">Construction</button>-->
            <img src="https://lh3.googleusercontent.com/22baMpag4TorlYZ2BoDjfgNBrlqUYTXRZIFWKZc_L6w_A29tChQtYoTmq47lLkMJLm2akOShVOtEags2SzSKyG8wzcqzalhNLuRQzKaN0wCAlOmzimRPsBGVF4HmEpdCbd_Pq22VH20YomUkE0EzcEGqCirei0ZxxgRz56pQbzYWEFZQQ1gpoNq8hblxQXoxyjN4v3sViM844TUZsVHO_2AmR2PsMiNw1xfZc3yPisqN6eDmRRdTaRzfpYCrC7h4QFvyBPWVV5CsSotaxaE4TZG1X7m-EGd5BMotPnxWtqbZxZV8rmTcnj7XVnBex1SHGSuAe9oWUs3dXMQnNeqLjXXVajxXWEsW0w5vke0EsVRAZWnUEts_aIEeYgCWMN2N4IL-joYMVN-tBR-z4ygqks3VciwAdrk8EWUQvuFUriTfpDRDqKh4XtRe0o_Ei0NptNFIBk2B8SXMqXqFo9IH8hAwvIDROuF8yEgcjMau5rCaL--qST7E2eo6WQT30S8RwjxdGEwbh2a9p1xKfu09NRm_pX2GdicbYLhwhN3TBBZHR9Cz3-ZevPxcaTdPvQKvkC6pJxQzAJt_TuX7J0Aeb1Tup4DyoQA_KggKeF0l5xGNFYzC9XgP3wENxLVMyTtugUgXCNlCGeW9V5NJ7ZQYZcgkWxyzIYIyE8VWEFiRDKwcSMlgKI7CUE1UzFogKzIjkS6XcNvGBNLSIcwDnPOY66D5=w958-h440-no?authuser=0" class="img-fluid" alt="..." />

            <!--Table of Database Items-->
            <div align="left" class="databasetable">
                <br />
                Current Area
                <input type="text" name="currentarea" id="currentarea" readonly>
                <br />
                Military
                <input type="text" name="military" id="military" readonly>
                <br />
                Lords
                <input type="text" name="lords" id="lords" readonly>

                <br /><br />

                <button id="militarycost" onclick="PurchaseMilitary()">Purchase Military</button>
                <input type="text" id="militaryPurchase" style="width:100px" />
                <br />
                <button id="lordcost" onclick="PurchaseLord()">Purchase Lords</button>
                <input type="text" id="lordsPurchase" style="width:100px" />

                <br /><br />

                <button onclick="TriggerDatabaseTab('manufacturing')">Manufacturing</button>
                <button onclick="TriggerDatabaseTab('civil')">Civil</button>
                <button onclick="TriggerDatabaseTab('commerce')">Commerce</button>
                <button onclick="TriggerDatabaseTab('military')">Military</button>

                <h2>Resources</h2>

                Food
                <input type="text" name="food" id="food" readonly>
                <br />
                Gold
                <input type="text" name="gold" id="gold" readonly>
                <br />
                Iron
                <input type="text" name="iron" id="iron" readonly>
                <br />
                Coal
                <input type="text" name="coal" id="coal" readonly>
                <br />
                Leather
                <input type="text" name="leather" id="leather" readonly>
                <br />
                Cloth
                <input type="text" name="cloth" id="cloth" readonly>
                <br />
                Obsidian
                <input type="text" name="obsidian" id="obsidian" readonly>
                <br />
                Wood
                <input type="text" name="wood" id="wood" readonly>
                <br />

                <div class="manufacturing">
                    <h2>Manufacturing</h2>

                    Iron Mine
                    <input type="text" name="ironmine" id="ironmine" readonly><br />
                    <button onclick="BuildStructure('ironmine')">Construct Iron Mine</button>
                    <h6><span id="ironminedescription"></span></h6>
                    Coal Mine
                    <input type="text" name="coalmine" id="coalmine" readonly><br />
                    <button onclick="BuildStructure('coalmine')">Construct Coal Mine</button>
                    <h6><span id="coalminedescription"></span></h6>
                    Pasture
                    <input type="text" name="pasture" id="pasture" readonly><br />
                    <button onclick="BuildStructure('pasture')">Construct Pasture</button>
                    <h6><span id="pasturedescription"></span></h6>
                    Cotton Field
                    <input type="text" name="cottonfield" id="cottonfield" readonly><br />
                    <button onclick="BuildStructure('cottonfield')">Construct Cotton Field</button>
                    <h6><span id="cottonfielddescription"></span></h6>
                    Obsidian Mine
                    <input type="text" name="obsidianmine" id="obsidianmine" readonly><br />
                    <button onclick="BuildStructure('obsidianmine')">Construct Obsidian Mine</button>
                    <h6><span id="obsidianminedescription"></span></h6>
                    Farm
                    <input type="text" name="farm" id="farm" readonly><br />
                    <button onclick="BuildStructure('farm')">Construct Farm</button>
                    <h6><span id="farmdescription"></span></h6>
                    Lumbermill
                    <input type="text" name="lumbermill" id="lumbermill" readonly><br />
                    <button onclick="BuildStructure('lumbermill')">Construct Lumbermill</button>
                    <h6><span id="lumbermilldescription"></span></h6>
                    Gold Mine
                    <input type="text" name="goldmine" id="goldmine" readonly><br />
                    <button onclick="BuildStructure('goldmine')">Construct Gold Mine</button>
                    <h6><span id="goldminedescription"></span></h6>
                </div>

                <div class="civil">
                    <h2>Civil</h2>

                    Healing
                    <input type="text" name="healing" id="healing" readonly><br />
                    <button onclick="BuildStructure('healing')">Construct Healing Church</button>
                    <h6><span id="healingdescription"></span></h6>
                    Dungeon
                    <input type="text" name="dungeon" id="dungeon" readonly><br />
                    <button onclick="BuildStructure('dungeon')">Construct Dungeon</button>
                    <h6><span id="dungeondescription"></span></h6>
                </div>

                <div class="commerce">
                    <h2>Commerce</h2>

                    Tavern
                    <input type="text" name="tavern" id="tavern" readonly><br />
                    <button onclick="BuildStructure('tavern')">Construct Tavern</button>
                    <h6><span id="taverndescription"></span></h6>
                    Market
                    <input type="text" name="market" id="market" readonly><br />
                    <button onclick="BuildStructure('market')">Construct Market</button>
                    <h6><span id="marketdescription"></span></h6>
                </div>

                <div class="military">
                    <h2>Military</h2>

                    Barracks
                    <input type="text" name="barracks" id="barracks" readonly><br />
                    <button onclick="BuildStructure('barracks')">Construct Barracks</button>
                    <h6><span id="barracksdescription"></span></h6>
                    Stable
                    <input type="text" name="stable" id="stable" readonly><br />
                    <button onclick="BuildStructure('stable')">Construct Stable</button>
                    <h6><span id="stabledescription"></span></h6>
                </div>
            </div>

            <div align="left" class="arealist">
                <div id="midContent" align="left">
                    <h2>Attacking</h2>
                    <span>Lord</span><br />
                    <input type="text" id="attackRecipient" style="width:100px" /><br />
                    <span>Troops</span><br />
                    <input type="text" id="attackAmount" style="width:100px" /><br />
                    <button onclick="Attack(document.getElementById('attackRecipient').value, document.getElementById('attackAmount').value)">Attack</button>

                    <h2>Trading</h2>
                    <span>Type</span>
                    <br />
                    <select id="type" style="width:100px">
                        <option value="food" selected>Food</option>
                        <option value="gold">Gold</option>
                        <option value="iron">Iron</option>
                        <option value="coal">Coal</option>
                        <option value="leather">Leather</option>
                        <option value="cloth">Cloth</option>
                        <option value="obsidian">Obsidian</option>
                        <option value="wood">Wood</option>
                    </select>
                    <br />
                    <span>Lord</span><br />
                    <input type="text" id="tradeRecipient" style="width:100px" /><br />
                    <span>Amount</span><br />
                    <input type="text" id="tradeAmount" style="width:100px" /><br />
                    <button onclick="Trade()">Trade</button>

                    <br />

                    <h2>Send Message</h2>
                    <span>Recipient</span><br />
                    <input type="text" id="messageRecipient" style="width:100px" /><br />
                    <span>Message</span><br />
                    <textarea type="text" id="messageContent" style="height:100px; resize:vertical" maxlength="200"></textarea><br />
                    <button onclick="SendMessage(document.getElementById('messageRecipient').value, document.getElementById('messageContent').value)">Send</button>

                    <br />

                    <h2>Messages</h2>
                    <button onclick="clearMessages()">Clear Messages</button>
                    <div><h4 id="messages" style="max-width:250px; word-wrap: break-word;"></h4></div>
                </div>

                Traveling To Area
                <input type="text" name="travelingto" id="travelingto" readonly>

                <h2>
                    Areas
                </h2>
                <h5><span id="areaListText"></span></h5>
            </div>

        </div>

    </div>

    <script>
        function TriggerDatabaseTab(className) {
            var tab = document.getElementsByClassName(className);
            for (var i = 0; i < tab.length; i++) {
                if (tab[i].style.display === "none" || tab[i].style.display === "") {
                    tab[i].style.display = "block";
                }
                else {
                    tab[i].style.display = "none";
                }
            }
        }
    </script>

    <script>
        // (!)
        function Attack(player, troops) {
            var numTroops = +troops;
            var attackValue = (+dStable > 0 ? (numTroops * +dStable) : numTroops);
            var retaliation = (+getDataFromPlayersDatabase(player, "stable") > 0 ? +getDataFromPlayersDatabase(player, "military") * +getDataFromPlayersDatabase(player, "stable") : +getDataFromPlayersDatabase(player, "military"));

            if (numTroops > 0) {
                setMilitary(+dMilitary - retaliation);
                changeDatabaseData(player, "military", -attackValue);
            }

            document.getElementById('attackRecipient').value = "";
            document.getElementById('attackAmount').value = "";
        }

        // (!)
        function Trade() {
            var amount = +(document.getElementById("tradeAmount").value);
            var recipient = document.getElementById("tradeRecipient").value;

            if (amount <= 0) {
                return;
            }

            if (GetResourceLevel(document.getElementById("type").value) >= amount) {
                changeDatabaseData(recipient, document.getElementById("type").value, amount);
                SetResourceLevel(document.getElementById("type").value, +GetResourceLevel(document.getElementById("type").value) - amount);

                document.getElementById("tradeRecipient").value = "";
                document.getElementById("tradeAmount").value = "";
            }
        }

        // (!)
        function SendMessage(rec, mes) {
            if (document.getElementById('messageContent').value !== "") {
                changeDatabaseData(rec, "messages", ("~" + dName + ": " + mes));

                document.getElementById('messageRecipient').value = "";
                document.getElementById('messageContent').value = "";
            }
        }

        function clearMessages() {
            setMessages("");
        }

        function MessagesText() {
            var ret = "";
            if (dMessages !== "") {
                var split = dMessages.split('~');
                for (var i = 0; i < split.length; i++) {
                    ret += split[i] + "<br />";
                }
            }
            return ret;
        }

        // (!)
        function PurchaseLord() {
            var amount = document.getElementById('lordsPurchase').value;

            if (isNaN(+amount) == false) {
                if (+dGold >= (lordCost() * +amount)) {
                    setGold(+dGold - (lordCost() * +amount), true);
                    setLords(+dLords + +amount);

                    document.getElementById('lordsPurchase').value = "";
                }
            }
        }
        // (!)
        function PurchaseMilitary() {
            var amount = document.getElementById('militaryPurchase').value;

            if (isNaN(+amount) == false) {
                if (+dGold >= (militaryCost() * +amount)) {
                    setGold(+dGold - (militaryCost() * +amount), true);
                    setMilitary(+dMilitary + +amount);

                    document.getElementById('militaryPurchase').value = "";
                }
            }
        }

        // (!)
        function GetTotalStructures() {
            return +dIronMine + +dCoalMine + +dPasture + +dCottonField + +dObsidianMine + +dFarm + +dGoldMine + +dLumbermill + +dHealing + +dDungeon + +dTavern + +dMarket + +dBarracks + +dStable;
        }

        function GetStructureDescription(structure) {
            var desc = '';
            if (structure === "ironmine") {
                desc = 'Produces Iron Daily';
            }
            else if (structure === "coalmine") {
                desc = 'Produces Coal Daily';
            }
            else if (structure === "pasture") {
                desc = 'Produces Leather Daily';
            }
            else if (structure === "cottonfield") {
                desc = 'Produces Cloth Daily';
            }
            else if (structure === "obsidianmine") {
                desc = 'Produces Obsidian Daily';
            }
            else if (structure === "farm") {
                desc = 'Produces Food Daily';
            }
            else if (structure === "goldmine") {
                desc = 'Produces Gold Daily';
            }
            else if (structure === "lumbermill") {
                desc = 'Produces Wood Daily';
            }
            else if (structure === "healing") {
                desc = 'Reduces Population Death From Disease';
            }
            else if (structure === "dungeon") {
                desc = 'Reduces Population Death From Crime';
            }
            else if (structure === "tavern") {
                desc = 'Increases The Daily Gold Per Military Unit';
            }
            else if (structure === "market") {
                desc = 'Increases Daily Gold Production';
            }
            else if (structure === "barracks") {
                desc = 'Increases Maximum Military Size';
            }
            else if (structure === "stable") {
                desc = 'Increases Strength Of Military Units';
            }
            var ret = desc + '<br><br>Requires:';
            var required = GetStructureObject(structure).requires;
            for (var i = 0; i < required.length; i++) {
                ret += '<br>' + required[i] + ' (' + GetResourceLevel(required[i]) + ' / ' + GetStructureLevel(structure) + ')';
            }
            return ret;
        }

        // (!)
        function SetResourceLevel(resource, amount) {
            if (resource === "food") {
                setFood(amount);
            }
            else if (resource === "iron") {
                setIron(amount);
            }
            else if (resource === "coal") {
                setCoal(amount);
            }
            else if (resource === "leather") {
                setLeather(amount);
            }
            else if (resource === "cloth") {
                setCloth(amount);
            }
            else if (resource === "obsidian") {
                setObsidian(amount);
            }
            else if (resource === "gold") {
                setGold(amount);
            }
            else if (resource === "wood") {
                setWood(amount);
            }
        }
        // (!)
        function GetResourceLevel(resource) {
            if (resource === "food") {
                return dFood;
            }
            else if (resource === "iron") {
                return dIron;
            }
            else if (resource === "coal") {
                return dCoal;
            }
            else if (resource === "leather") {
                return dLeather;
            }
            else if (resource === "cloth") {
                return dCloth;
            }
            else if (resource === "obsidian") {
                return dObsidian;
            }
            else if (resource === "gold") {
                return dGold;
            }
            else if (resource === "wood") {
                return dWood;
            }
        }
        // (!)
        function GetStructureLevel(structure) {
            if (structure === "ironmine") {
                return dIronMine;
            }
            else if (structure === "coalmine") {
                return dCoalMine;
            }
            else if (structure === "pasture") {
                return dPasture;
            }
            else if (structure === "cottonfield") {
                return dCottonField;
            }
            else if (structure === "obsidianmine") {
                return dObsidianMine;
            }
            else if (structure === "farm") {
                return dFarm;
            }
            else if (structure === "goldmine") {
                return dGoldMine;
            }
            else if (structure === "lumbermill") {
                return dLumbermill;
            }
            else if (structure === "healing") {
                return dHealing;
            }
            else if (structure === "dungeon") {
                return dDungeon;
            }
            else if (structure === "tavern") {
                return dTavern;
            }
            else if (structure === "market") {
                return dMarket;
            }
            else if (structure === "barracks") {
                return dBarracks;
            }
            else if (structure === "stable") {
                return dStable;
            }
        }
        // (!)
        function GetStructureObject(structure) {
            if (structure === "ironmine") {
                return ironMine;
            }
            else if (structure === "coalmine") {
                return coalMine;
            }
            else if (structure === "pasture") {
                return pasture;
            }
            else if (structure === "cottonfield") {
                return cottonField;
            }
            else if (structure === "obsidianmine") {
                return obsidianMine;
            }
            else if (structure === "farm") {
                return farm;
            }
            else if (structure === "goldmine") {
                return goldMine;
            }
            else if (structure === "lumbermill") {
                return lumbermill;
            }
            else if (structure === "healing") {
                return healing;
            }
            else if (structure === "dungeon") {
                return dungeon;
            }
            else if (structure === "tavern") {
                return tavern;
            }
            else if (structure === "market") {
                return market;
            }
            else if (structure === "barracks") {
                return barracks;
            }
            else if (structure === "stable") {
                return stable;
            }
        }

        const ironMine = {};
        ironMine.requires = ['gold', 'food', 'coal'];
        const coalMine = {};
        coalMine.requires = ['iron', 'wood', 'food', 'gold'];
        const pasture = {};
        pasture.requires = ['cloth', 'coal', 'wood'];
        const cottonField = {};
        cottonField.requires = ['iron', 'leather', 'wood'];
        const obsidianMine = {};
        obsidianMine.requires = ['iron', 'wood', 'obsidian', 'gold'];
        const farm = {};
        farm.requires = ['cloth', 'leather', 'wood'];
        const goldMine = {};
        goldMine.requires = ['iron', 'coal', 'obsidian', 'gold'];
        const lumbermill = {};
        lumbermill.requires = ['iron', 'obsidian', 'leather'];
        const healing = {};
        healing.requires = ['cloth', 'coal', 'food', 'wood'];
        const dungeon = {};
        dungeon.requires = ['coal', 'iron', 'obsidian'];
        const tavern = {};
        tavern.requires = ['cloth', 'gold', 'coal', 'wood'];
        const market = {};
        market.requires = ['wood', 'gold', 'cloth', 'food'];
        const barracks = {};
        barracks.requires = ['obsidian', 'iron', 'wood', 'leather', 'gold'];
        const stable = {};
        stable.requires = ['obsidian', 'iron', 'wood', 'leather', 'gold'];

        // (!)
        function BuildStructure(structure) {
            if (GetTotalStructures() >= +dLords) {
                alert('More Lords are needed for further construction');
                return;
            }

            if (GetIfHaveResources(structure)) {
                var structureObj = GetStructureObject(structure);
                var level = GetStructureLevel(structure);
                for (var i = 0; i < structureObj.requires.length; i++) {
                    if (structureObj.requires[i] === "food") {
                        setFood(+dFood - level, true);
                    }
                    else if (structureObj.requires[i] === "iron") {
                        setIron(+dIron - level, true);
                    }
                    else if (structureObj.requires[i] === "coal") {
                        setCoal(+dCoal - level, true);
                    }
                    else if (structureObj.requires[i] === "leather") {
                        setLeather(+dLeather - level, true);
                    }
                    else if (structureObj.requires[i] === "cloth") {
                        setCloth(+dCloth - level, true);
                    }
                    else if (structureObj.requires[i] === "obsidian") {
                        setObsidian(+dObsidian - level, true);
                    }
                    else if (structureObj.requires[i] === "gold") {
                        setGold(+dGold - level, true);
                    }
                    else if (structureObj.requires[i] === "wood") {
                        setWood(+dWood - level, true);
                    }
                }

                if (structure === "ironmine") {
                    setIronMine(+dIronMine + 1, true);
                }
                else if (structure === "coalmine") {
                    setCoalMine(+dCoalMine + 1, true);
                }
                else if (structure === "pasture") {
                    setPasture(+dPasture + 1, true);
                }
                else if (structure === "cottonfield") {
                    setCottonField(+dCottonField + 1, true);
                }
                else if (structure === "obsidianmine") {
                    setObsidianMine(+dObsidianMine + 1, true);
                }
                else if (structure === "farm") {
                    setFarm(+dFarm + 1, true);
                }
                else if (structure === "goldmine") {
                    setGoldMine(+dGoldMine + 1, true);
                }
                else if (structure === "lumbermill") {
                    setLumbermill(+dLumbermill + 1, true);
                }
                else if (structure === "healing") {
                    setHealing(+dHealing + 1, true);
                }
                else if (structure === "dungeon") {
                    setDungeon(+dDungeon + 1, true);
                }
                else if (structure === "tavern") {
                    setTavern(+dTavern + 1, true);
                }
                else if (structure === "market") {
                    setMarket(+dMarket + 1, true);
                }
                else if (structure === "barracks") {
                    setBarracks(+dBarracks + 1, true);
                }
                else if (structure === "stable") {
                    setStable(+dStable + 1, true);
                }
                // Because didn't update with above setters
                update_value();
            }
            else {
                console.log("Do not have necessary resources");
            }
        }
        function GetIfHaveResources(structure) {
            var structureObj = GetStructureObject(structure);
            for (var i = 0; i < structureObj.requires.length; i++) {
                if (+GetResourceLevel(structureObj.requires[i]) < +GetStructureLevel(structure)) {
                    return false;
                }
            }
            return true;
        }

        // (!)
        function ResourceProduction(resource, noUpdate = false) {
            if (resource === "food") {
                setFood(+dFood + 1 + +dFarm, noUpdate);
            }
            else if (resource === "iron") {
                setIron(+dIron + 1 + +dIronMine, noUpdate);
            }
            else if (resource === "coal") {
                setCoal(+dCoal + 1 + +dCoalMine, noUpdate);
            }
            else if (resource === "leather") {
                setLeather(+dLeather + 1 + +dPasture, noUpdate);
            }
            else if (resource === "cloth") {
                setCloth(+dCloth + 1 + +dCottonField, noUpdate);
            }
            else if (resource === "obsidian") {
                setObsidian(+dObsidian + 1 + +dObsidianMine, noUpdate);
            }
            else if (resource === "gold") {
                setGold(+dGold + 1 + +dGoldMine, noUpdate);
            }
            else if (resource === "wood") {
                setWood(+dWood + 1 + +dLumbermill, noUpdate);
            }
        }

        // (!)
        function GetAreaPlayerList() {
            var retTable = '';

            // For each area: for each player in area: print player info
            for (var a = 0; a < areas.areaList.length; a++) {
                retTable += '<button type="button" onclick="SetTravelTo(\'' + areas.areaList[a] + '\')">' + areas.areaList[a] + '</button><br />';

                retTable += "Resources: ";
                for (var i = 0; i < GetAreaObject(areas.areaList[a]).resources.length; i++) {
                    if (i == 0) {
                        retTable += GetAreaObject(areas.areaList[a]).resources[i];
                    }
                    else {
                        retTable += ', ' + GetAreaObject(areas.areaList[a]).resources[i];
                    }
                }
                retTable += '<br>';

                for (var i = 0; i < GetPlayersInArea(areas.areaList[a]).length; i++) {
                    var playerName = GetPlayersInArea(areas.areaList[a])[i];
                    var militaryNumber = getDataFromPlayersDatabase(playerName, "military");
                    var goldNumber = getDataFromPlayersDatabase(playerName, "gold");
                    if (goldNumber.charAt(goldNumber.length - 1) === ',') {
                        var goldNumber = goldNumber.slice(0, -1);
                    }

                    retTable += "&nbsp; &nbsp; &nbsp;" + playerName + ' (' + militaryNumber + ' military, ' + goldNumber + ' gold)' + '<br />';
                }

                retTable += '<br />';
            }

            return retTable;
        }
        // (!)
        function GetPlayersInArea(areaName) {
            var ret = [];

            // For each player: if player area == areaName, add player to list
            for (var i = 0; i < getAllPlayerNames().length; i++) {
                var playerArea = getDataFromPlayersDatabase(getAllPlayerNames()[i], "currentarea");
                if (playerArea === areaName) {
                    ret.push(getAllPlayerNames()[i]);
                }
            }

            return ret;
        }
        // (!)
        function GetArea(areaName) {
            for (var i = 0; i < areas.areaList.length; i++) {
                if (areas.areaList[i] === areaName) {
                    return areas.areaList[i];
                }
            }
            return null;
        }
        // (!)
        function GetAreaObject(areaName) {
            if (areaName === "Goldfort" || areaName === "goldfort") {
                return goldfort;
            }
            else if (areaName === "Stonehall" || areaName === "stonehall") {
                return stonehall;
            }
            else if (areaName === "Woodshire" || areaName === "woodshire") {
                return woodshire;
            }
            else if (areaName === "Lavachasm" || areaName === "lavachasm") {
                return lavachasm;
            }
            else if (areaName === "Firepine" || areaName === "firepine") {
                return firepine;
            }
            else if (areaName === "Snowfall" || areaName === "snowfall") {
                return snowfall;
            }
            else if (areaName === "Talltree" || areaName === "talltree") {
                return talltree;
            }
            else if (areaName === "Mountall" || areaName === "mountall") {
                return mountall;
            }
            else if (areaName === "Seaclipse" || areaName === "seaclipse") {
                return seaclipse;
            }
            else if (areaName === "Grassea" || areaName === "grassea") {
                return grassea;
            }
            else if (areaName === "Capital" || areaName === "capital") {
                return capital;
            }
            else if (areaName === "Sandaciar" || areaName === "sandaciar") {
                return sandaciar;
            }
            else if (areaName === "Northern Abyss" || areaName === "northernabyss") {
                return northernabyss;
            }
        }
        // (!)
        function SetTravelTo(areaName) {
            if (GetAreaObject(areaName) != null && GetAreaObject(dCurrentArea) != null) {
                var toArea = GetAreaObject(areaName);

                if (ConnectedIncludes(GetAreaObject(dCurrentArea), toArea.name)) {
                    setTravelingTo(areaName);
                    document.getElementById("travelingto").value = dTravelingTo;
                }
            }
        }

        function ConnectedIncludes(area, includes) {
            for (var i = 0; i < area.connected.length; i++) {
                if (area.connected[i] === includes) {
                    return true;
                }
            }
            return false;
        }

        const areas = {};
        areas.areaList = ["Goldfort", "Stonehall", "Woodshire", "Lavachasm", "Firepine", "Snowfall", "Talltree", "Mountall", "Seaclipse", "Grassea", "Capital", "Sandaciar", "Northern Abyss"]
        const goldfort = {};
        goldfort.name = "Goldfort";
        goldfort.resources = ["food", "gold", "iron"];
        goldfort.connected = ["Capital", "Snowfall", "Grassea", "Northern Abyss"];
        const stonehall = {};
        stonehall.name = "Stonehall";
        stonehall.resources = ["obsidian", "coal", "iron"];
        stonehall.connected = ["Sandaciar", "Lavachasm", "Firepine", "Grassea"];
        const woodshire = {};
        woodshire.name = "Woodshire";
        woodshire.resources = ["food", "wood", "cloth"];
        woodshire.connected = ["Talltree", "Mountall"];
        const lavachasm = {};
        lavachasm.name = "Lavachasm";
        lavachasm.resources = ["obsidian", "gold", "iron"];
        lavachasm.connected = ["Firepine", "Grassea", "Stonehall"];
        const firepine = {};
        firepine.name = "Firepine";
        firepine.resources = ["wood", "coal", "iron"];
        firepine.connected = ["Lavachasm", "Grassea"];
        const snowfall = {};
        snowfall.name = "Snowfall";
        snowfall.resources = ["wood", "cloth", "leather"];
        snowfall.connected = ["Capital", "Goldfort", "Grassea", "Sandaciar", "Seaclipse"];
        const talltree = {};
        talltree.name = "Talltree";
        talltree.resources = ["food", "wood", "leather"];
        talltree.connected = ["Woodshire", "Mountall", "Northern Abyss"];
        const mountall = {};
        mountall.name = "Mountall";
        mountall.resources = ["food", "coal", "iron"];
        mountall.connected = ["Woodshire", "Talltree", "Seaclipse", "Capital", "Snowfall", "Northern Abyss"];
        const seaclipse = {};
        seaclipse.name = "Seaclipse";
        seaclipse.resources = ["food", "cloth", "obsidian"];
        seaclipse.connected = ["Mountall", "Snowfall"];
        const grassea = {};
        grassea.name = "Grassea";
        grassea.resources = ["food", "leather", "cloth"];
        grassea.connected = ["Goldfort", "Snowfall", "Sandaciar", "Stonehall", "Lavachasm", "Firepine"];
        const capital = {};
        capital.name = "Capital";
        capital.resources = ["food", "coal", "iron"];
        capital.connected = ["Goldfort", "Snowfall", "Mountall", "Seaclipse"];
        const sandaciar = {};
        sandaciar.name = "Sandaciar";
        sandaciar.resources = ["cloth", "iron", "coal"];
        sandaciar.connected = ["Stonehall", "Grassea", "Snowfall"];
        const northernabyss = {};
        northernabyss.name = "Northern Abyss";
        northernabyss.resources = ["wood", "cloth", "leather"];
        northernabyss.connected = ["Talltree", "Mountall", "Goldfort"];

        var canDayEvent = false;

        function tick() {
            //get the mins of the current time
            var hours = new Date().getHours();
            if (hours == "00") {
                if (canDayEvent) {
                    DayEvent();
                }
            }
            else {
                canDayEvent = true;
            }
            //console.log('Tick ' + hours);
        }
        function fastMinuteEvent() {
            if (loggedIn) {
                if (TimeSince(dLastDate) > 24) {
                    setLastDate(new Date().getTime(), true);
                    DayEvent();
                }

                setDataWithName();
            }
        }
        //function slowMinuteEvent() {
        //    if (loggedIn) {
        //        if (TimeSince(dLastDate) > 24) {
        //            DayEvent();
        //        }
        //    }
        //    //setLastDate(new Date().getTime());
        //}

        function DayEvent() {
            canDayEvent = false;

            for (var i = 0; i < GetAreaObject(dCurrentArea).resources.length; i++) {
                ResourceProduction(GetAreaObject(dCurrentArea).resources[i], i == GetAreaObject(dCurrentArea).resources.length - 1);
            }

            if (dTravelingTo !== "") {
                setCurrentArea(dTravelingTo, true);
                alert("You have arrived in " + dTravelingTo);
                setTravelingTo("", true);
            }

            if (dMilitary > 10) {
                if (+dMilitary > (.6 * +dBarracks)) {
                    var change = Math.ceil((.1 * +dMilitary) - (+dHealing * 3));
                    setMilitary(+dMilitary - change, true);

                    if (change < 0) {
                        alert("Military gained " + Math.abs(change) + " units from disease, thanks to healing churches");
                    }
                    else {
                        alert("Military lost " + change + " units from disease");
                    }
                }
                if (+dMilitary > (.6 * +dBarracks)) {
                    var change = Math.ceil((.1 * +dMilitary) - (+dDungeon * 3));
                    setMilitary(+dMilitary - change, true);

                    if (change < 0) {
                        alert("Military gained " + Math.abs(change) + " units from crime, thanks to dungeons");
                    }
                    else {
                        alert("Military lost " + change + " units from crime");
                    }
                }
            }

            setGold(+dGold + 10, true);
            alert("You have received 10 gold from taxation");

            var tavernGold = (+dMilitary * +dTavern);
            setGold(+dGold + tavernGold, true);
            alert("You have received " + tavernGold + " gold from your taverns");

            var marketGold = (10 * +dMarket);
            setGold(+dGold + marketGold);
            alert("You have received " + marketGold + " gold from your markets");
        }

        // (!)
        function TimeSince(pastTime) {
            return ((new Date().getTime() - pastTime) / 1000 / 60 / 60);
        }

        setInterval(fastMinuteEvent, 10000);
        //setInterval(slowMinuteEvent, 50000);
        setInterval(tick, 1000);
    </script>

    <!--<button onclick="testFunction('yahoo')">Test Button</button>
    <script>
        function testFunction(test) {
            setMessages(test);
        }
    </script>-->

</div>